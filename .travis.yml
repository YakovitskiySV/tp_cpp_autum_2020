dist: trusty
sudo: required
language: c

os: linux
compiler: clang

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - g++-9
      - gcc-9
      - valgrind
      - cmake
      - cppcheck
      - lcov
      - gcovr
      - clang

before_script:
  - sudo apt-get install -y libgtest-dev
  - cd /usr/src/gtest
  - sudo cmake .
  - sudo make
  - sudo cp *.a /usr/lib

script:
  - cd "${TRAVIS_BUILD_DIR}"
  - ./linters/run.sh
  - CXX=/usr/bin/g++-9 CC=/usr/bin/clang
  - cmake .
  - make
  - valgrind --version
  - valgrind -v --show-leak-kinds=all --track-origins=yes --leak-check=no ./tests.out
  - bash <(curl -s https://codecov.io/bash)
